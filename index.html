<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1" />
<title></title>
<link rel="icon" type="image/svg" href="icon.svg" />
<link rel="apple-touch-icon" href="icon.png" sizes="192x192" />
<link rel="manifest" href="app.json" />
<link rel="stylesheet" href="pico.css" />
</head>
<body>
<div id="container">
	<h1 id="header">
		<div class="logo">
			<a id="title" href="javascript:picoOnTitle();">
			<a id="subtitle" href="javascript:top.location.reload();"></a>
		</div>
		<div class="menu center">
			<a class="item light secret" id="action" href="javascript:picoOnAction();">
				<span id="actionText"></span>
				<img class="icon" id="actionIcon" src="" />
			</a>
		</div>
		<div class="menu">
			<a class="item clear" id="minus" href="javascript:picoOnSelect(-1);">-</a>
			<a class="item light" id="select" href="javascript:picoOnSelect(0);">
				<span id="selectText"></span>
				<img class="icon" id="selectIcon" src="" />
			</a>
			<a class="item clear" id="plus" href="javascript:picoOnSelect(+1);">+</a>
		</div>
	</h1>
	<div id="contents">
		<div id="screen" class="picoImage picoTouch"></div>
	</div>
</div>
<h6 id="footer">
	<div id="author"></div>/
	<div id="version"></div>
</h6>
<!--script>console.log = () => {};</script!-->
<script src="pico.js"></script>
<script src="picod.js"></script>
<!--Event--><script>
pico.apppath = "./index.html"; // App file path.
pico.apprefer = null; // Refer script.
pico.appscript = null; // App script.
pico.apptitle = ""; // App title.
pico.appurl = null; // Referenced url.
pico.appver = 0; // App version.

// Change label.
function picoLabel(id, text=null, icon=null) {
	let e = document.getElementById(id);
	if (e) {
		e.style.display = (text || icon) ? "flex" : "none";
		let e1 = document.getElementById(id + "Text");
		let e2 = document.getElementById(id + "Icon");
		if (e1 && text) {
			e1.style.display = "flex";
			e1.innerText = text;
			if (e2 && !icon) {
				e2.style.display = "none";
			}
		} else if (e2 && icon) {
			e2.style.display = "flex";
			e2.src = icon;
			if (e1 && !text) {
				e1.style.display = "none";
			}
		} else if (text) {
			e.innerText = text;
		}
	}
	picoFlush();
}

// Change title.
function picoTitle(text=null, subtext=null) {
	let e = document.getElementsByTagName("title");
	if (e && e[0]) {
		if (text) {
			e[0].style.display = "flex";
			e[0].innerText = text;
		} else {
			e[0].style.display = "none";
			e[0].innerText = "";
		}
	}
	if (text) {
		pico.apptitle = text;
		picoLabel("title", text);
	}
	if (subtext) {
		picoLabel("subtitle", subtext)
	}
}

// Switch script or share.
async function picoSwitch(script=null) {
	if (pico.appver > 0) {
		picoSetStrings(pico.appver, "v");
	}

	// Change and reload script.
	if (script) {
		picoSetStrings(pico.apppath, "u");
		if (pico.apptitle) {
			picoSetStrings(pico.apptitle, "t");
		}
		picoSetStrings(script, "s");
		if (pico.appscript) {
			picoSetStrings(pico.appscript, "r");
		}
		await picoReload();

	// Back or jump to next app.
	} else if (pico.appurl) {
		if (pico.apprefer) {
			picoSetStrings(pico.apprefer, "s");
		}
		await picoReload(pico.appurl);

	// Share.
	} else {
		await picoShare();
	}
}

// On title label.
async function picoOnTitle() {
	picoResetParams();
	if (pico.appver > 0) {
		picoSetStrings(pico.appver, "v");
	}
	await picoReload();
}

// On acction button.
async function picoOnAction() {
	await appAction();
}

// On select button.
async function picoOnSelect(x) {
	await appSelect(x);
}

// On load event.
async function picoOnLoad() {
	let script = picoStrings("s");
	if (script) {
		pico.appscript = script;
	}
	var e = document.createElement('script');
	e.src = pico.appscript ? pico.appscript : "app.js";
	document.body.appendChild(e);
}

// On main loop.
async function picoOnMain() {
	let refer = picoStrings("r");
	if (refer) {
		pico.apprefer = refer;
	}
	let title = picoStrings("t");
	if (title) {
		pico.apptitle = title;
		picoTitle(pico.apptitle);
	}
	pico.appurl = picoStrings("u");
	pico.appver = picoStrings("v");
	await appLoad();
	picoFlush(); // Flush to skip first read.
	for (;;) {
		await picoRead();
		picoClear();
		await appMain();
		await picoFlip(0);
	}
}

picoOnLoad(); // Load.
window.onload = picoOnMain; // Main.
</script><!--/Event-->
</body>
</html>
